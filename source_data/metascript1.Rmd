---
title: "metascript1.Rmd"
output: html_document
---
if README.md, this needs to be updated.
```{r setup, include=FALSE}
library(aws.s3)
library(rmarkdown)
#library(boxr)
source_rmd = function(file, ...) {
  tmp_file = tempfile(fileext=".R")
  on.exit(unlink(tmp_file), add = TRUE)
  knitr::purl(file, output=tmp_file)
  source(file = tmp_file, ...)
}
```
Critical input data files for Merger_file.Rmd 
1. Full deidentified redcap data: ncovrcmain-deident.Rmd
2. Screening PCR data:  "ncovPCRtempsxresults1.csv" from https://obj.umiacs.umd.edu/obj/bucket/ncov-secure-reports/view/
3. "StopCOVIDsamples.csv" (key containing vars of interest: subject id, date of collection, and sample type). The most current version of this file is generated by https://gitlab.umiacs.umd.edu/prometheus/freqcheck/-/blob/master/LIMSreadspec1.Rmd which currently runs on CI at 12am daily, and is stored at https://obj.umiacs.umd.edu/obj/bucket/stopcovid-samples-listing/view/
4. "ncovg2samplesmasksyn.csv" (mask(y/n), cough number, G-II session number, G-II reservoir time data) The most current version of this file is generated by https://gitlab.umiacs.umd.edu/prometheus/ncov/-/blob/master/nCoVG2mask.Rmd which currently runs on CI at 3am daily, and is stored at https://obj.umiacs.umd.edu/obj/bucket/stopcovid-samples-listing/view/
5. culture results processing.Rmd
6. serology results processing.Rmd
```{r update source_data files}
# 1. Full deidentified redcap data from ncovrcmain-deident.Rmd
source_rmd("ncovrcmain-deident.Rmd")

# x. Sx onset data: "onsetdates_latest.csv" ==> from ncovrcmainonset.Rmd
# merged into Merger_file2 - source_rmd("ncovrcmainonset.Rmd")

# 2. Screening PCR data
objaccess <- Sys.getenv("OBJ_ACCESS_FHH") # put your personal access key name here
objsecret <- Sys.getenv("OBJ_SECRET_FHH") # put your personal secret key name here
Sys.setenv("AWS_ACCESS_KEY_ID" = objaccess,
           "AWS_SECRET_ACCESS_KEY" = objsecret,
           "AWS_S3_ENDPOINT"="obj.umiacs.umd.edu",
           "AWS_DEFAULT_REGION"="ncov-secure-reports")
ncovPCRtempsxresults1 <- s3read_using(FUN=read.csv,object="ncovPCRtempsxresults1.csv",stringsAsFactors=F,bucket="")
write.csv(ncovPCRtempsxresults1,file="ncovPCRtempsxresults1.csv",row.names=F)

# 3. "StopCOVIDsamples.csv"
catchaccess <- Sys.getenv("OBJ_ACCESS_CATCH") # put the CATCH group access key name here
catchsecret <- Sys.getenv("OBJ_SECRET_CATCH") # put the CATCH group secret key name here
Sys.setenv("AWS_ACCESS_KEY_ID" = catchaccess,
           "AWS_SECRET_ACCESS_KEY" = catchsecret,
           "AWS_S3_ENDPOINT"="obj.umiacs.umd.edu",
           "AWS_DEFAULT_REGION"="stopcovid-samples-listing")
StopCOVIDsamples <- s3read_using(FUN=read.csv,object="StopCOVIDsamples.csv",stringsAsFactors=F,bucket="")
write.csv(StopCOVIDsamples,file="StopCOVIDsamples.csv",row.names=F)

# 4. "ncovg2samplesmasksyn.csv"
catchaccess <- Sys.getenv("OBJ_ACCESS_CATCH") # put the CATCH group access key name here
catchsecret <- Sys.getenv("OBJ_SECRET_CATCH") # put the CATCH group secret key name here
Sys.setenv("AWS_ACCESS_KEY_ID" = catchaccess,
           "AWS_SECRET_ACCESS_KEY" = catchsecret,
           "AWS_S3_ENDPOINT"="obj.umiacs.umd.edu",
           "AWS_DEFAULT_REGION"="stopcovid-samples-listing")
ncovg2samplesmasksyn <- s3read_using(FUN=read.csv,object="ncovg2samplesmasksyn.csv",stringsAsFactors=F,bucket="")
write.csv(ncovg2samplesmasksyn,file="ncovg2samplesmasksyn.csv",row.names=F)

# 5. culture results processing.Rmd
source_rmd("culture results processing.Rmd")

# 6. serology results processing.Rmd
source_rmd("serology results processing.Rmd")

# 7. qPCR fits and sample quants.Rmd
source_rmd("qPCR fits and sample quants.Rmd")
```

Run Merger file 2.Rmd, and move all old datasets into old folders

